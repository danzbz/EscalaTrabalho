@model EscalaTrabalho.Model.CalendarioMOD

<table id="eventos" class="d-none">
    @foreach (var dia in Model.ListaDiasUteis)
    {
        @foreach (var funcionario in dia.ListaFuncionarioNaEscala)
        {
            <tr>
                <td>@funcionario.Id</td>
                <td>@funcionario.NmFuncionario</td>
                <td>@dia.DtInicio.ToString("yyyy-MM-dd")</td>
            </tr>
        }
    }
</table>

<table id="eventosFeriados" class="d-none">
    @foreach (var feriado in Model.ListaFeriadoPublico)
    {
        <tr>
            <td>@feriado.Global</td>
            <td>@feriado.LocalName</td>
            <td>@feriado.Date.ToString("yyyy-MM-dd")</td>
        </tr>
    }
</table>

<div class="row">

    <div class="col-12">
        <table class="table">
            <thead>
                <tr>
                    <td>
                        Colaborador
                    </td>
                    <td>Qtd. de Homes</td>
                </tr>

                @foreach (var colaborador in Model.ListaFuncionario)
                {
                    <tr>
                        <td>
                            @colaborador.NmFuncionario
                        </td>
                        <td>
                            @Model.ListaDiasUteis.Where(x => x.ListaFuncionarioNaEscala.Any(y => y.Id == colaborador.Id)).Count()
                        </td>
                    </tr>
                }

            </thead>
        </table>
    </div>

    <div class="col-12">
        <div id="calendar"></div>
    </div>
</div>

<script>
    let eventsArr = loadData();
    let calendar = initCalendar();

    var event = { id: 1, title: 'New event', start: new Date() };

    $('#calendar').fullCalendar('renderEvent', event, true)

    function loadData() {
        let eventsArr = [];

        let todoTable = document.getElementById("eventos");
        let trElem = todoTable.getElementsByTagName("tr");
        console.log(trElem);
        for (let tr of trElem) {
            console.log(tr);
            let tdElems = tr.getElementsByTagName("td");
            let eventObj = {
                id: tdElems[0].innerText,
                title: tdElems[1].innerText,
                start: tdElems[2].innerText,
            }

            console.log(eventObj.start);

            eventsArr.push(eventObj);
        }

        let tabelaFeriado = document.getElementById("eventosFeriados");
        let trFeriado = tabelaFeriado.getElementsByTagName("tr");
        console.log(trFeriado);
        for (let tr of trFeriado) {
            console.log(tr);
            let tdElems = tr.getElementsByTagName("td");
            let eventObj = {
                id: tdElems[0].innerText,
                title: tdElems[1].innerText,
                start: tdElems[2].innerText,
            }

            console.log(eventObj.start);

            eventsArr.push(eventObj);
        }

        return eventsArr;
    }



    function initCalendar() {

        console.log('entrou')

        var calendarEl = document.getElementById('calendar');

        let calendar = new FullCalendar.Calendar(calendarEl, {
            editable: true,
            locale: 'pt-br',
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: eventsArr,
        });

        calendar.render();

        console.log(calendar);

        return calendar;
    }
</script>